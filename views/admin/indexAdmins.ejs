<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.css">
    <script src="https://cdn.jsdelivr.net/semantic-ui/2.2.4/semantic.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.1.0.min.js"></script>
    <title>Crata-Admin</title>
</head>
<body style="background-color: black;" class="container">
    <h3 style="color: #fff;margin-top: 50px;" class="ui center aligned icon header">Administrator</h3>
    <main>
        <div class="ui grid container">
            <div class="ui two column centered grid">
                <div class="column">
                    <form class="ui form" action="/indexAdmin" method="get">
                        <div class="field">
                            <input name="q" type="text" placeholder="Search" value="<%= searchValue %>" />
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="ui grid container">
            <div class="ui eight column centered grid preview-images">
                <% posts.forEach(function(post, index) { %>
                <div class="column">
                    <div style="max-width:100px; max-height: 250px;" class="ui card">
                        <div class="image">
                            <img src="<%= post.url %>" style="max-height:250px;">
                        </div>
                        <div class="content">
                            <a class="header"><%= post.public_id %></a>
                            <div class="meta">
                                <span class="date">
                                    <i class="calendar icon"></i>
                                    <%= post.created_at %>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <% }) %>
            </div>
        </div>
    </main>
    <script>
        var nextCursor = "<%= nextCursor %>"; // Server-side rendered next cursor value

        $(window).scroll(function() {
            if ($(window).scrollTop() + $(window).height() >= $(document).height() - 100) {
                if (nextCursor) {
                    $.get('/loadMoreImages', { next_cursor: nextCursor }, function(data) {
                        nextCursor = data.nextCursor;
                        data.posts.forEach(function(post) {
                            var column = $('<div>').addClass('column');
                            var card = $('<div>').addClass('ui card').css({ maxWidth: '100px', maxHeight: '250px' });
                            var image = $('<div>').addClass('image');
                            var img = $('<img>').attr('src', post.url).css({ maxHeight: '250px' });
                            var content = $('<div>').addClass('content');
                            var header = $('<a>').addClass('header').text(post.public_id);
                            var meta = $('<div>').addClass('meta');
                            var date = $('<span>').addClass('date').html('<i class="calendar icon"></i>' + post.created_at);
                            
                            image.append(img);
                            meta.append(date);
                            content.append(header).append(meta);
                            card.append(image).append(content);
                            column.append(card);
                            $('.preview-images').append(column);
                        });
                    }).fail(function() {
                        console.error('Error loading more images');
                    });
                }
            }
        });
    </script>
</body>
</html>